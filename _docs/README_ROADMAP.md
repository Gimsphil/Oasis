# 📊 전체 구현 현황 및 로드맵

**마지막 업데이트**: 2026-01-31  
**전체 진행도**: 50% 완료 (세부 구현 중)

---

## 🎯 현재 상태

### ✅ PHASE 1 완료 (100%)

#### ✅ PHASE 1-1: TAB 키 + 자료사전 팝업 (완료)
```
구현된 기능:
├─ TAB 키 이벤트 핸들러
├─ 자료사전 팝업 UI (6컬럼)
├─ 데이터 전송 규칙
├─ 검색 기능
├─ 수동 CODE 매칭 (===)
└─ W 컬럼 검증 메서드

파일: database_reference_popup.py (신규)
     lighting_power_manager.py (수정)
```

#### ✅ PHASE 1-2: 1식 저장 (완료)
```
구현된 기능:
├─ 최종 합계 계산
├─ 산출내역서에 1식 데이터 저장
├─ 내보내기 버튼 처리
├─ ESC 키 처리
└─ 데이터 연동 메커니즘

파일: lighting_power_manager.py (수정)
```

---

## 📈 전체 진행도 차트

```
[====================================                  ] 50%

PHASE 1 (완료): ████████████████████ (100%)
├─ PHASE 1-1: ████████ (100%) ✅
├─ PHASE 1-2: ████████ (100%) ✅
└─ 소계: ████████ (100%) ✅

PHASE 2 (계획): ░░░░░░░░░░░░░ (0%)
├─ W 컬럼 색상
├─ 조각파일 (F9)
└─ 재진입 상태 복구

PHASE 3 (계획): ░░░░░░░░░░░░░ (0%)
└─ 고급 기능들
```

---

## 🗺️ 로드맵 (상세)

### **[✅ 완료] PHASE 1: 핵심 3기능 (3-5일)**

#### PHASE 1-1: TAB 키 → 자료사전 팝업 ✅
- [x] detail_table에 이벤트 필터 설치
- [x] TAB 키 감지
- [x] 자료사전 팝업 호출
- [x] DatabaseReferencePopup 클래스 생성
- [x] 팝업 UI (상단/중앙/하단)

#### PHASE 1-2: 데이터 전송 + 매칭 ✅
- [x] 자료사전 데이터 로드
- [x] 산출일위 품목 리스트 표시
- [x] 수량 입력 → 보내기 → 데이터 전송
- [x] 텍스트 검색
- [x] 수동 CODE 매칭 (===)
- [x] W 컬럼 검증 (_verify_all_codes)

#### PHASE 1-3: 1식 저장 ✅
- [x] 최종 합계 계산 (get_final_sum)
- [x] 산출내역서 저장 (save_to_gapji)
- [x] 내보내기 버튼 처리
- [x] ESC 키 처리
- [x] 팝업 ↔ 부모 데이터 연동

---

### **[⏳ 예정] PHASE 2: 색상 + 기본 기능 (2-3일)**

#### PHASE 2-1: W 컬럼 색상 표시
```
필요 사항:
□ 일위대가(i) 행: 짙은 청색 텍스트
□ 미매칭(~*) 행: 붉은색 텍스트 (선택)
□ CODE 빈값(**) 행: 노란색 배경 (선택)

구현 위치:
- database_reference_popup.py: W 컬럼 생성 시 색상 설정
- lighting_power_manager.py: _verify_all_codes() 색상 업데이트
```

#### PHASE 2-2: 조각파일 (.piece) 기능
```
필요 사항:
□ F9 키 감지
□ 선택 행 데이터 추출
□ JSON 파일로 저장
□ 파일 불러오기 UI
□ 데이터 삽입 로직

구현 위치:
- lighting_power_manager.py: LightingPowerPopup 클래스
- 신규: piece_file_handler.py (권장)

파일 포맷 (예정):
```json
{
  "version": "1.0",
  "data": [
    {"w": "--", "code": "ABC", "product": "조명기구", "qty": "50"},
    {"w": "--", "code": "DEF", "product": "전선", "qty": "100"}
  ]
}
```

#### PHASE 2-3: 재진입 상태 복구
```
필요 사항:
□ 이전 입력값 복구
□ 커서 위치 복구
□ 스크롤 위치 복구

구현 위치:
- lighting_power_manager.py: set_data() 및 restore_data()
- database_reference_popup.py: 초기 로드 시 데이터 표시
```

---

### **[📋 예정] PHASE 3: 고급 기능 (2-3일)**

#### PHASE 3-1: 실시간 계산 프리뷰
```
□ 산출일위 수정 시 산출목록 합계 즉시 업데이트
□ 계 컬럼 실시간 계산
```

#### PHASE 3-2: 유효성 검사
```
□ 단위수식 오류 감지 (예: 12++3)
□ 배경색 변경 (노란색) 경고
□ 필수 필드 누락 경고
```

#### PHASE 3-3: 추가 단축키
```
□ Ctrl+S: 임시 저장
□ Ctrl+Z / Ctrl+Y: Undo/Redo
□ Ctrl+F: 전체 검색
```

---

## 📂 파일 구조 (현황)

```
OutputDetail_Standalone/
│
├── ✅ main.py
│   └─ 앱 진입점, 경로 설정, 예외 처리
│
├── ✅ output_detail_tab.py
│   └─ 산출내역서(갑지) UI
│
├── ✅ lighting_power_manager.py (PHASE 1 완료)
│   ├─ LightingPowerManager
│   ├─ LightingPowerPopup (세부산출조서 팝업)
│   │   ├─ TAB 키 이벤트 ✅
│   │   ├─ 자료사전 팝업 호출 ✅
│   │   ├─ 1식 저장 메서드 ✅
│   │   ├─ ESC/버튼 처리 ✅
│   │   └─ W 컬럼 검증 ✅
│   └─ evaluate_math() (사칙연산)
│
├── ✅ database_reference_popup.py (PHASE 1 완료)
│   ├─ DatabaseReferencePopup 클래스
│   ├─ 자료사전 데이터 로드
│   ├─ 상단 품목 리스트
│   ├─ 검색 기능 ✅
│   ├─ 수동 매칭 (===) ✅
│   ├─ 데이터 전송 ✅
│   └─ ESC/Enter 키 처리 ✅
│
├── ⏳ piece_file_handler.py (PHASE 2-2)
│   └─ 조각파일 저장/불러오기 (예정)
│
├── ✅ core/app_style.py
│   └─ 폰트 + 스타일
│
├── ✅ utils/column_settings.py
│   └─ 컬럼 정의
│
├── ✅ utils/grid_clipboard.py
│   └─ 클립보드
│
└── 📚 문서
    ├── ARCHITECTURE_ANALYSIS.md
    ├── IMPLEMENTATION_STATUS.md
    ├── ANALYSIS_SUMMARY.md
    ├── PHASE1_IMPLEMENTATION.md
    ├── PHASE1_2_IMPLEMENTATION.md
    └── README_ROADMAP.md (본 파일)
```

---

## 🔴 미확정 사항

| 항목 | 현황 | 필요사항 |
|------|------|---------|
| 일위대가 판정 기준 | ⚠️ 임시 | CODE.startswith('i') vs 다른 기준? |
| 자료사전 테이블 스키마 | ⚠️ 부분 | 그룹/목록2~6/약칭 컬럼 확인 |
| 색상 규칙 상세 | ⏳ 예정 | 청색/빨강 RGB 값 확정 |
| 조각파일 포맷 | ⏳ 예정 | JSON vs CSV vs 이진 선택 |
| 저장 정책 | ⏳ 예정 | 엑셀/DB/메모리 중 선택 |

---

## ✅ 검증 항목 (테스트 대기)

### PHASE 1 테스트

#### PHASE 1-1 테스트
- [ ] TAB 키 → 팝업 호출
- [ ] 자료사전 데이터 표시
- [ ] 품목 리스트 표시
- [ ] 데이터 전송
- [ ] 검색 기능
- [ ] === 매칭

#### PHASE 1-2 테스트
- [ ] 산출일위 합계 계산
- [ ] 산출내역서 1식 저장
- [ ] 내보내기 버튼 동작
- [ ] ESC 키 동작
- [ ] 각 컬럼 값 확인

---

## 📞 사용자 확인 필요

### 1. 자료사전.db 스키마
```
현재: ID, 품목, 규격, 단위, CODE 로드됨
필요: 다음 컬럼 확인
  - 그룹 (검색용?)
  - 목록2~6 (추가 정보?)
  - 약칭 (단축명?)
  - W (이미 사용 중?)
  - 산출목록 (중복?)
  - 검색목록 (별도 인덱스?)
```

### 2. 일위대가 판정
```
현재: CODE.startswith('i')로 임시 구현
확인 필요:
  - 정확한 판정 기준
  - 어느 컬럼/값?
  - 조명기구타입.db와 관계?
```

### 3. 조각파일 정책
```
포맷 선택: JSON / CSV / 이진?
저장 위치: 사용자 선택 다이얼로그?
파일명: *.piece?
```

---

## 🎓 구현 경험치 요약

### 학습 항목 ✅
- PyQt6 이벤트 필터 및 키 감지
- 팝업 ↔ 부모 윈도우 데이터 전달
- QTableWidget 고급 활용
- SQLite3 데이터 조회
- 사칙연산 보안 처리 (eval 제약)
- 다단계 팝업 구조 (3차 창)

### 개선 가능 영역 ⚠️
- 클래스 크기 최소화 (분리)
- 설정 파일 외부화
- 테스트 코드 작성
- 문서 주석 강화
- 타입 힌팅 추가

---

## 🚀 다음 실행 계획

### 즉시 (오늘)
1. ✅ PHASE 1 완료
2. ⏳ 테스트 수행
3. ⏳ 버그 수정

### 단기 (1주일)
1. ⏳ PHASE 2 구현
   - W 컬럼 색상
   - 조각파일 기능
   - 재진입 복구

### 중기 (2주일)
1. ⏳ PHASE 3 구현
   - 실시간 계산
   - 유효성 검사
   - 추가 단축키

---

## 📋 최종 체크리스트

### 코드 품질
- [x] 경로 설정 명확화 ✅
- [x] 예외 처리 강화 ✅
- [x] 함수/메서드 문서화
- [x] 디버깅 로그 추가 ✅
- [ ] 테스트 코드 작성 (예정)

### 기능 완성도
- [x] TAB 키 이벤트 ✅
- [x] 자료사전 팝업 ✅
- [x] 데이터 전송 ✅
- [x] 검색 기능 ✅
- [x] 수동 매칭 ✅
- [x] W 컬럼 검증 ✅
- [x] 1식 저장 ✅
- [ ] 색상 표시 (PHASE 2)
- [ ] 조각파일 (PHASE 2)
- [ ] 재진입 복구 (PHASE 2)

---

## 📊 시간 추정

| 단계 | 예상 소요 | 현황 | 비고 |
|------|---------|------|------|
| PHASE 1-1 | 2-3일 | ✅ 완료 | TAB + 팝업 |
| PHASE 1-2 | 1-2일 | ✅ 완료 | 1식 저장 |
| PHASE 2 | 2-3일 | ⏳ 예정 | 색상/조각파일/복구 |
| PHASE 3 | 2-3일 | ⏳ 예정 | 고급 기능 |
| **총합** | **7-11일** | **50%** | |

---

**전체 진행도**: 🟢 50% (핵심 기능 완료, 추가 기능 예정)

마지막 업데이트: 2026-01-31
